# Clothing Classifier

**Прокопьев Дмитрий Сергеевич**

Детектор головы и тела соперника и союзника во время игры CS2.

## Постановка задачи

Детекция головы и тела соперников и союзников во время игры. Рассматриваю этот проект как учебный, чтобы глубже разобраться с современными архитектурами компьютерного зрения, в частности с YOLO, которая является одной из самых популярных моделей для задач детекции в реальных проектах.

## Формат данных

- **Вход**: изображение PNG, размер 1920×1080
- **Выход**: набор (id класса, координаты прямоугольника в котором находится объект)

## Метрики

- mAP50
- precision
- mAP50-95
- recall

У итоговой версии модели метрики такие:

- mAP50: 0.69806
- mAP50-95: 0.48001
- precision: 0.82844
- recall: 0.6539

Метрики получились чуть ниже ожидаемых, возможно, дело в том, что была взята маленькая модель YOLOv8, мало эпох обучения и не очень много данных.

## Датасет

[Counter Strike 2 Body and Head Classification](https://www.kaggle.com/datasets/merfarukgnaydn/counter-strike-2-body-and-head-classification?resource=download)
— Около 500 размеченных изображений, для тренировки и валидации. Каждое изображение - скриншот из игры Counter Strike 2, и в пару к каждому изображению есть label.txt с границами и классификацией ct_body , ct_head , t_body , t_head.

---

## Setup

Проект создавался с помощью uv.

1. Установить uv: https://docs.astral.sh/uv/getting-started/installation/
2. В корне проекта выполнить:

```bash
uv sync
```

## Train

Для успешного запуска должен быть поднят mlflow server. Поэтому перед обучением
в отдельном окне надо выполнить команду:

```bash
uv run mlflow ui --port 8080
```

Далее для самого обучения надо из корня проекта выполнить команду:

```bash
uv run python cs2-body-head-detection/main.py train
```

При этом загружается датасет (внутри функции обучения вызывается функция
download_data, там либо из локального хранилища, настроенного с помощью dvc,
загружается файл, либо с kaggle.)

Результаты сохраняются в:

- `runs/detect/train{i}/weights` — веса модели (где i - номер запуска)
- `model_weights/yolov8n.pt` - веса изначальной модели
- `model_weights/yolov8n.onnx` — ONNX последней модель

- MLflow UI: http://localhost:8080

### Параметры обучения

Конфигурация в `configs/`:

- `training/default.yaml` — параметры обучения
- `logging/default.yaml` - параметры логгирования
- `model/deefault.yaml` - параметры модели

## Production preparation

Во время выполнения файла с обучением, после успешного обучения модель
конвертируется в onnx. Можно ее конвертировать с помощью функции export_onnx из
файла utils.py

## Inference

Будет работать только после успешного обучения, ведь она использует модель `cs2_body_head_detection/model_weights/yolov8n.onnx`
Для выполнения инференса надо из корня проекта выполнить команду:

```bash
uv run python cs2-body-head-detection/main.py infer --source name_file_for_inference.png
```

Результаты сохраняются в `runs/detect/predict{i}`, где i - номер эксперимента.
